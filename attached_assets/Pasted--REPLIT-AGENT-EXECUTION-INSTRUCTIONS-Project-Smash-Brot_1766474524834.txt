ğŸ” REPLIT AGENT â€” EXECUTION INSTRUCTIONS
Project: Smash Brothers Burgers â€“ Final Dashboard
Mode: Surgical Recovery (No Refactors, No UI Redesigns)
Goal: Restore full business operability TODAY
ğŸš¨ ABSOLUTE RULES (NON-NEGOTIABLE)
DO NOT refactor
DO NOT rename tables
DO NOT change form schemas
DO NOT invent data
DO NOT touch UI styling
NO fixes without a read-only diagnostic first
Every fix must name:
Writer
Reader
Table
After each step, prove rows exist with SQL
If you violate any rule, STOP.
âœ… CURRENT VERIFIED STATE (DO NOT RECHECK)
These are already fixed and verified:
daily_stock_v2 now receives data
Historical backfill completed
Purchasing items seeded
purchasing_field_map exists
Purchasing Shift Log shows shifts
F&B Analysis loads shifts
You must not redo or undo these.
ğŸ§± PATCH SEQUENCE (MANDATORY ORDER)
ğŸ”¹ PATCH 3 â€” PURCHASING â†’ SHOPPING LIST POPULATION
ğŸ¯ Objective
Make Shopping List and Purchasing List populate with real data.
ğŸ” READ-ONLY DIAGNOSTIC (REQUIRED FIRST)
Confirm requisition fields exist in daily_stock_v2.payload
Confirm purchasing_field_map mappings:
rollsEnd
meatEndKg
drinkStockJson
Confirm purchasing item names exactly match map targets
DO NOT FIX until diagnostic output is shown.
ğŸ”§ FIX (ONLY IF DIAGNOSTIC CONFIRMS)
Action
Extend purchasing sync logic to:
Read mapped stock fields
Create purchasing_shift_items rows
Scope
File: server/services/purchasingShiftSync.ts
Tables:
READ: daily_stock_v2
WRITE: purchasing_shift_items
Constraints
No calculations
No aggregation
1 shift â†’ N purchasing items
Idempotent (safe re-run)
âœ… VERIFICATION (MANDATORY)
Run and paste results:
Copy code
Sql
SELECT COUNT(*) FROM purchasing_shift_items;
SELECT shift_date, COUNT(*) FROM purchasing_shift_items GROUP BY shift_date;
ğŸ”¹ PATCH 4 â€” SHOPPING LIST API RESTORATION
ğŸ¯ Objective
Make Shopping List page show items.
ğŸ” READ-ONLY DIAGNOSTIC
Identify which route serves:
/api/shopping-list/latest
Identify which ORM is used (Prisma vs Drizzle)
Identify actual table name being queried
ğŸ”§ FIX
Action
Remove references to non-existent:
ShoppingListV2
shopping_list_v2
Replace with canonical tables:
shopping_list
shopping_list_items
Scope
Backend route only
No schema changes
No UI changes
âœ… VERIFICATION
Copy code
Sql
SELECT * FROM shopping_list ORDER BY created_at DESC LIMIT 1;
SELECT COUNT(*) FROM shopping_list_items;
Shopping List page must show data.
ğŸ”¹ PATCH 5 â€” P&L 401 AUTH BLOCKER
ğŸ¯ Objective
Remove authentication blockage preventing P&L from loading.
ğŸ” READ-ONLY DIAGNOSTIC
Confirm /api/profit-loss middleware
Confirm required headers:
x-user-id
x-restaurant-id
Confirm frontend sends none
ğŸ”§ FIX (CHOOSE ONE, DEFAULT = A)
Option A (Preferred):
Allow internal dashboard access without auth
Keep auth for external calls
Option B:
Inject headers from frontend session
No role system changes allowed.
âœ… VERIFICATION
Copy code
Bash
curl /api/profit-loss
P&L page must load without 401.
ğŸ”¹ PATCH 6 â€” DAILY REVIEW EMAIL (TOP PRIORITY)
ğŸ¯ Objective
Restore ONE SINGLE EMAIL:
â€œDaily Review â€“ Manager Summaryâ€
ğŸ“§ EMAIL MUST INCLUDE (TABLES ONLY)
Sales Summary
Cash / QR / Grab / Other
Total Sales
Shift Expenses
Itemised
Total
Finance
Starting Cash
Expected Register
Actual Register
Balanced (Yes/No)
Cash to Bank
QR to Bank
POS vs Daily Sales
Variances
Receipts
Discounts
Refunds
Items Sold
Category
Qty
Sales
Meat & Buns
Expected
Actual
Variance
Status
Purchasing
Items
Qty
Estimated Cost
RULES
HTML tables only
No charts
No emojis
No placeholders
If data missing â†’ explicitly say why
âœ… VERIFICATION
Trigger email manually
Paste rendered output
Confirm real numbers, not zeros
ğŸ”¹ PATCH 7 â€” FINAL SYSTEM SANITY CHECK
ğŸ¯ Objective
Confirm business can operate.
REQUIRED PAGES TO LOAD DATA
Purchasing List âœ…
Shopping List âœ…
Shift Log âœ…
F&B Analysis âœ…
Sales & Shift Analysis âœ…
Daily Review Email âœ…
P&L âœ…
ğŸ›‘ STOP CONDITIONS
Agent MUST STOP if:
A table is empty unexpectedly
A route queries a non-existent model
An auth error appears
Any fix would require refactor
ğŸ“Œ FINAL NOTE TO AGENT
This system worked last week.
Your job is not to redesign â€” it is to reconnect broken wires.
If unsure: â¡ï¸ Diagnose
â¡ï¸ Show SQL
â¡ï¸ Ask before changing