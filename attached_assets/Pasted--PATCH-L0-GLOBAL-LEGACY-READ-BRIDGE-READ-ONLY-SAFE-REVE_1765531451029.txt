ğŸŸ© PATCH L0 â€” GLOBAL LEGACY READ BRIDGE

(READ-ONLY Â· SAFE Â· REVERSIBLE Â· REQUIRED)

ğŸ¯ Goal

Restore ALL historical data visibility across the system
without migrating, mutating, or risking production data


---

ğŸ”’ HARD RULES (ABSOLUTE)

âŒ No schema changes

âŒ No migrations

âŒ No deletes

âŒ No writes to legacy tables

âŒ No background jobs

âŒ No data copying


âœ… READ-ONLY FALLBACK ONLY


---

ğŸ§© AFFECTED MODULES (ALL OF THESE)

Module	Status

Daily Sales	âŒ Broken
Daily Stock	âŒ Broken
Shopping List	âŒ Broken
Purchases (Rolls/Meat/Drinks)	âŒ Broken
Expenses	âŒ Broken
Ingredients	âŒ Broken
Recipes	âŒ Broken
Menu	âŒ Broken
Suppliers	âŒ Broken



---

ğŸ§  STRATEGY (SYSTEM-WIDE)

> If V2 / V3 table is empty â†’ READ from legacy table



No exceptions.


---

ğŸ› ï¸ IMPLEMENTATION (FOR REPLIT AGENT)

1ï¸âƒ£ Create ONE Core Bridge Service

File:

server/services/legacyReadBridge.ts

Pattern (generic, reused everywhere):

export async function readWithFallback({
  prisma,
  primary,
  legacy,
  query = {}
}) {
  const primaryRows = await prisma[primary].findMany(query);

  if (primaryRows.length > 0) {
    return { source: 'v2', rows: primaryRows };
  }

  const legacyRows = await prisma[legacy].findMany(query);

  return { source: 'legacy', rows: legacyRows };
}


---

2ï¸âƒ£ Apply Bridge to ALL Read Routes

Replace direct reads in:

dailySales*

dailyStock*

shoppingList*

expenses*

purchases*

ingredients*

recipes*

menu*

suppliers*


Example:

readWithFallback({
  prisma,
  primary: 'expenses_v2',
  legacy: 'expenses'
})

ğŸš« DO NOT create new endpoints
ğŸš« DO NOT change URLs
ğŸš« DO NOT rename responses


---

3ï¸âƒ£ Frontend: Global Legacy Indicator

Add once (reused everywhere):

{data.source === 'legacy' && (
  <Alert variant="warning">
    Legacy Data (Read-Only) â€” Pre-Upgrade Records
  </Alert>
)}


---

4ï¸âƒ£ Frontend: Disable Mutations for Legacy Data

If source === 'legacy':

Disable:

Edit

Delete

Sync

Recalculate


Tooltip:

> â€œLegacy record â€” read-onlyâ€





---

âœ… SUCCESS CRITERIA (YOU SHOULD SEE THIS)

After deploy:

âœ… All historical sales visible

âœ… All purchases visible

âœ… Shopping lists reappear

âœ… Ingredients populate

âœ… Recipes populate

âœ… Menu items visible

âœ… Expenses show up

âœ… No data duplication

âœ… No write access to legacy data



---

ğŸ§  WHY THIS IS THE CORRECT SaaS MOVE

This gives you:

Clean enterprise schema going forward

Zero-risk visibility backwards

A controlled migration path (L2)

Investor-safe architecture

Multi-tenant ready foundation


This is exactly how Stripe, Shopify, Square handle legacy transitions.


---

ğŸ“Œ FINAL COPY-PASTE FOR AGENT

> â€œImplement PATCH L0 â€” Global Legacy Read Bridge.
All read endpoints must fallback to legacy tables if V2/V3 tables are empty.
Read-only only. No schema changes. No migrations. No deletes.â€




---