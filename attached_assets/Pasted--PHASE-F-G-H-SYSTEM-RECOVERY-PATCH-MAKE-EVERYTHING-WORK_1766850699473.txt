ğŸš¨ PHASE F(+G+H) â€” SYSTEM RECOVERY PATCH
â€œMAKE EVERYTHING WORK â€” NO NEW FEATURESâ€
âš ï¸ ABSOLUTE RULES
DO NOT add new pages
DO NOT change navigation
DO NOT redesign UI
DO NOT invent data
DO NOT refactor architecture
ONLY fix errors, missing wiring, broken routes, null reads, guards blocking valid flows
READ / FIX / BACKFILL / GUARD ONLY
ğŸ¯ OBJECTIVE
Bring the system to a state where:
No page returns 500
No page silently returns empty when data exists
All operational pages load with real data
Forms submit
Lists populate
Analytics read paths donâ€™t crash
âœ… PHASE F â€” HARD REQUIREMENTS
F1 â€” ELIMINATE ALL 500 ERRORS (GLOBAL)
MANDATORY
Scan server logs for every 500
For each:
Identify missing table / bad relation / null access / auth guard
Fix at the source
Replace silent failures with:
Copy code
Ts
return res.status(200).json({ success: true, data: [] })
where empty is valid
ğŸš« No throwing unless truly fatal
F2 â€” PURCHASING LIST (MASTER)
Must work 100%
Page loads
Shows ALL purchasing_items
Active / inactive toggle works
Category grouping matches Form 2 categories
Items can be reactivated (currently broken)
No deletion allowed if:
used in recipes
referenced in shifts
marked is_ingredient
If deletion fails â†’ return clear error message
F3 â€” FORM 2 (DAILY STOCK & SALES)
CRITICAL â€” STAFF BLOCKER
Form must submit
Stock validation must only reference purchasing_items
Required drinks = category = 'Drinks' AND active = true
If missing â†’ return structured error:
Copy code
Json
{
  "success": false,
  "reason": "MISSING_REQUIRED_STOCK",
  "missing": [{ "category": "Drinks", "item": "Water" }]
}
ğŸš« NO reference to foodCostings
ğŸš« NO hidden required items
F4 â€” PURCHASING LOG (EX SHIFT LOG)
Must always show data
Reads from purchasing_shift_items
Shows:
All active purchasing items
All shifts
Zero quantities explicitly
If no data â†’ show empty table, NOT crash
F5 â€” SHOPPING LIST
NO 500s, EVER
Read-only
Derived from purchasing_shift_items
Group by supplier if available
If no shifts â†’ return empty list
Never query non-existent tables (shopping_list_v2, etc.)
F6 â€” INGREDIENTS (DERIVED VIEW)
DO NOT CREATE NEW SOURCE
Ingredients = purchasing_items WHERE is_ingredient = true
No separate ingredient DB writes
Portion fields editable
Cost always read-only
If none exist â†’ show empty state
F7 â€” RECIPES
STABILITY ONLY
/recipe-management must:
load
list recipes
not crash on incomplete recipes
Cost calculation must:
ignore incomplete recipes
never throw
Legacy recipe pages:
stay read-only
must not 500
F8 â€” POS â†” RECIPE MAPPING (READ PATH FIX)
NO LOGIC CHANGE
Debug endpoints must not crash:
/api/debug/recipe-pos-parity
/api/debug/unmapped-pos-items
/api/debug/incomplete-recipes
If nothing mapped â†’ return empty arrays
F9 â€” ANALYSIS PAGES
READ PATH ONLY
Pages:
F&B Analysis
Sales & Shift Analysis
Daily Summary Reports
Requirements:
If data exists â†’ show it
If no data â†’ empty state
ğŸš« NO crashes due to null joins / missing relations
F10 â€” GLOBAL DEFENSIVE FIXES
Apply everywhere:
Optional chaining on all DB reads
Default empty arrays for joins
Guard against undefined params
Never assume:
recipe exists
ingredient exists
shift exists
ğŸ§ª REQUIRED VERIFICATION (DO NOT SKIP)
After patch:
Load every sidebar page
Confirm:
No 500
No blank page with data present
Submit Form 2 successfully
Purchasing List:
Reactivate an item
Purchasing Log:
Shows quantities
Shopping List:
Loads (even empty)
ğŸ›‘ STOP CONDITION
If ANY page:
crashes
returns 500
hides existing data
ğŸ‘‰ STOP and FIX before proceeding
ğŸ“Œ DELIVERABLE
One commit
No feature additions
No UI redesign
System must be operationally usable