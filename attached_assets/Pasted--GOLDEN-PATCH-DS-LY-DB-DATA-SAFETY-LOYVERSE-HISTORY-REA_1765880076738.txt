ğŸš¨ GOLDEN PATCH â€” DS-LY-DB (DATA SAFETY + LOYVERSE HISTORY + REAL DASHBOARD)

NON-NEGOTIABLE RULES (READ FIRST)

âŒ NO schema deletions

âŒ NO table drops

âŒ NO data overwrites

âŒ NO resets until backups are verified

âœ… ADDITIVE ONLY

âœ… READ-ONLY imports

âœ… EVERYTHING visible in UI


If any step cannot be completed safely â†’ STOP and REPORT.


---

PHASE 1 â€” DATA SAFETY LOCK (DS-1) ğŸ” DO FIRST

1. Create Immutable Backup System (PRODUCTION)

Backend

Implement a backup service that:

Exports full PostgreSQL SQL dump

Exports CSV for every table

Zips exports with timestamp


Store backups in Google Drive (already configured)

Schedule:

Daily automatic backup

Weekly full archive


Add manual endpoint:

POST /api/admin/backup/run


Verification

Log backup success/failure

Persist last backup timestamp



---

2. Admin UI â€” Backup Visibility (MANDATORY)

Add to Settings / Admin:

â€œLast Successful Backupâ€

â€œBackup Status: OK / FAILEDâ€

â€œRun Backup Nowâ€ button


If this UI is not visible â†’ patch is incomplete.


---

PHASE 2 â€” LOYVERSE HISTORICAL IMPORT (LY-1) ğŸ“œ

CANONICAL RULE

Historical truth source: Loyverse

Import range: July 1st 2025 â†’ today

Imported data is READ-ONLY



---

3. Import Loyverse Data (Additive)

Create importer that pulls and stores:

Shift reports (daily totals)

Orders (aggregated)

Payments (by type)

Menu categories

Menu items

Modifiers


All rows must include:

source = 'loyverse_import'
importedAt = timestamp

âŒ Do NOT overwrite existing rows
âŒ Do NOT touch forms or emails


---

4. Data Model (Additive Only)

If needed, create:

historical_sales

historical_shifts

historical_menu_items


These tables are:

Read-only

Never edited by UI

Used for reporting only



---

PHASE 3 â€” DASHBOARD THAT ACTUALLY SHOWS BUSINESS DATA (DB-1) ğŸ“Š

5. Executive Metrics (TOP OF DASHBOARD)

MUST display immediately after import:

Total Orders (since July 1)

Total Revenue

Average Order Value

Orders Today

Orders by Channel (POS / Online / Partner)


If these numbers are zero after import â†’ FAIL PATCH.


---

6. Operations Intelligence Table (CRITICAL)

Create table:

â€œCumulative Purchasing Demandâ€

Derived from:

Stock requests

Loyverse sales

Roll purchase CSV (when added)


Columns:

Item Name

Requested Qty (7d / 30d / All-time)

Purchased Qty

Variance

Status (OVER / UNDER / OK)


This table MUST be visible in dashboard UI.

This is not optional.


---

PHASE 4 â€” HARD TESTING & VISIBILITY RULE ğŸ§ª

7. Seed & Verify

Agent MUST:

Seed test data if real data unavailable

Provide:

Screenshot locations

Navigation path

Before / after description



No screenshots = not complete.


---

FINAL ACCEPTANCE CRITERIA âœ…

Patch is ONLY complete if ALL are true:

âœ… Backups running & visible in UI

âœ… Loyverse history visible (non-zero)

âœ… Dashboard shows real numbers

âœ… No legacy data deleted

âœ… No schema destruction

âœ… No silent failures



---

WHY THIS PATCH MATTERS (DO NOT SKIP)

This patch:

Makes data loss impossible

Makes the dashboard demonstrable

Creates investor-safe architecture

Stops invisible patch hell

Converts the project into a real SaaS foundation



---
