‚úÖ PATCH 3 ‚Äî SHOPPING LIST PDF EXPORT (Enterprise-Grade)

This patch adds:

What Patch 3 Delivers

A backend PDF generator specifically for Shopping List V2

A new API endpoint /api/shopping-list/pdf/latest

A polished, clean brand-safe PDF layout (white, black, orange accents)

Automatic inclusion of:

Date generated

Shift reference

All requested shopping items (item, qty, notes)


Download button added to the Shopping List page

Zero changes to core forms

Zero interference with Fort Knox structures

No modifications to the shopping list pipeline logic


Agent constraints remain strict:

Only modify the files listed

Only paste what is provided

No refactoring, no ‚Äúimprovements,‚Äù no touching other systems

No schema changes

No prettier across project



---

üö® REPLIT AGENT ‚Äî STRICT DO / DO NOT

DO

Paste exact code only

Modify only the files listed

Save and exit


DO NOT

‚ùå Modify form structures

‚ùå Modify Drizzle schemas

‚ùå Modify Daily Sales V2 or Daily Stock V2

‚ùå Modify shopping list builder logic

‚ùå Create new folders outside stated structure

‚ùå Rename imports or paths

‚ùå Apply formatting across entire repo



---

üî• PATCH 3 ‚Äî FULL CUT-AND-PASTE CONTENT


---

1. BACKEND ‚Äî Create PDF Generator

File: server/services/shoppingListPDF.ts
(Create this file)

// PATCH 3 ‚Äî SHOPPING LIST PDF EXPORT
// STRICT: No other modifications allowed.

import PDFDocument from "pdfkit";
import prisma from "../prismaClient";
import { Readable } from "stream";

export async function generateShoppingListPDF() {
  const list = await prisma.shoppingListV2.findFirst({
    orderBy: { createdAt: "desc" },
  });

  if (!list) return null;

  const doc = new PDFDocument({ margin: 40 });

  const stream = new Readable({
    read() {},
  });

  doc.on("data", (chunk) => stream.push(chunk));
  doc.on("end", () => stream.push(null));

  // TITLE
  doc.fontSize(22).fillColor("#000000").text("Smash Brothers Burgers", {
    align: "left",
  });

  doc.moveDown(0.3);
  doc.fontSize(16).fillColor("#333333").text("Shopping List", {
    align: "left",
  });

  doc.moveDown(0.5);
  doc
    .fontSize(10)
    .fillColor("#555555")
    .text(`Generated: ${new Date().toLocaleString("en-TH", { timeZone: "Asia/Bangkok" })}`);

  doc.moveDown(1);

  // TABLE HEADER
  doc.fontSize(12).fillColor("#ff6a00").text("Item", { continued: true, width: 200 });
  doc.text("Qty", { continued: true, width: 80 });
  doc.text("Notes", { width: 250 });

  doc.moveDown(0.3);
  doc.moveTo(40, doc.y).lineTo(550, doc.y).stroke("#ff6a00");
  doc.moveDown(0.5);

  // TABLE ROWS
  list.items.forEach((i: any) => {
    doc
      .fontSize(11)
      .fillColor("#000000")
      .text(i.item, { continued: true, width: 200 });

    doc.text(String(i.quantity), { continued: true, width: 80 });

    doc.text(i.notes || "-", { width: 250 });

    doc.moveDown(0.3);
  });

  doc.end();
  return stream;
}


---

2. BACKEND ‚Äî Add PDF Route

File: server/routes/shoppingListRoutes.ts
(APPEND this block after the /latest route)

import { generateShoppingListPDF } from "../services/shoppingListPDF";

router.get("/pdf/latest", async (req, res) => {
  try {
    const pdfStream = await generateShoppingListPDF();

    if (!pdfStream) {
      return res.status(404).json({ error: "No shopping list available." });
    }

    res.setHeader("Content-Type", "application/pdf");
    res.setHeader(
      "Content-Disposition",
      "attachment; filename=shopping-list.pdf"
    );

    pdfStream.pipe(res);
  } catch (err) {
    console.error("PDF generation error:", err);
    res.status(500).json({ error: "Failed to generate PDF" });
  }
});


---

3. FRONTEND ‚Äî Add Download PDF Button

File: client/src/pages/operations/shopping-list/index.tsx
(Add this button above the list)

<button
  onClick={() => {
    window.open("/api/shopping-list/pdf/latest", "_blank");
  }}
  className="mb-4 px-4 py-2 bg-black text-white rounded hover:bg-gray-800"
>
  Download PDF
</button>

Place it right under your <h1>.


---

üèÅ PATCH 3 COMPLETE