ðŸ” PHASE K-4 â€” RECEIPT EVIDENCE LAYER (MANDATORY)
ðŸŽ¯ Objective
Make receipt count the primary evidence in Sales & Shift Analysis so managers can immediately verify cashier integrity before reviewing money, stock, or reconciliation.
Receipts are the evidence.
Everything else is secondary.
ðŸš« Scope Restrictions
âŒ No UI redesign
âŒ No schema changes
âŒ No strategy refactor
âŒ No blocking modals
âœ… Backend + minimal frontend only
âœ… Read-only evidence layer
ðŸ§± CORE RULE (NON-NEGOTIABLE)
If receipt counts donâ€™t match, nothing else is trusted.
âœ… REQUIRED IMPLEMENTATION
1ï¸âƒ£ Backend â€” Receipt Evidence Derivation
Add receipt evidence fields to the daily reconciliation response:
Copy code
Ts
{
  posReceiptCount: number | null,
  cashierReceiptCount: number | null,
  receiptDifference: number | null
}
Sources:
POS receipts
COUNT(pos_receipts) within business window (17:00 â†’ 03:00)
Cashier receipts
daily_sales_v2.receipt_count
Logic:
If either source exists â†’ date is VALID
Only show â€œMissing both sourcesâ€ if both counts are null
receiptDifference = pos - cashier (if both exist)
âš ï¸ Do NOT throw errors
âš ï¸ Always return HTTP 200
âš ï¸ Log [SAFE_FALLBACK_USED] if either source missing
2ï¸âƒ£ Backend â€” Status Mapping
Derive receipt status before money or stock logic:
Condition
Status
POS = Cashier
EVIDENCE_MATCH
POS > Cashier
MISSING_RECEIPTS
POS < Cashier
PHANTOM_RECEIPTS
POS missing
POS_UNAVAILABLE
Cashier missing
FORM_MISSING
Both missing
NO_EVIDENCE
Expose this as receiptStatus.
3ï¸âƒ£ Frontend â€” Evidence Summary (TOP OF PAGE)
Add a non-blocking Evidence Summary at the top of Sales & Shift Analysis, above reconciliation.
Display:
POS Receipts: X
Cashier Declared: Y
Difference: X âˆ’ Y
Visual rules:
Difference = 0 â†’ green
Difference â‰  0 â†’ red
Missing source â†’ amber
Always visible
Dismissible (optional)
âš ï¸ No modals
âš ï¸ No disabling the page
4ï¸âƒ£ UI Copy (Exact Language)
â€œReceipts are the primary evidence for this shiftâ€
â€œReceipt mismatch detected â€” investigate cashier activityâ€
â€œReceipt counts match â€” proceed with reconciliationâ€
5ï¸âƒ£ Acceptance Criteria (Must All Pass)
Any date with POS receipts shows receipt count
Any date with Daily Sales shows cashier receipt count
Dates no longer show â€œMissing both formsâ€ incorrectly
Managers can audit cashier behavior without scrolling
Page remains usable regardless of mismatch
No 500 errors under any condition
ðŸ§  Why This Is Canonical
Matches real-world audit behavior
Restores trust immediately
Turns disputes into facts
Makes POS a witness, not a crutch
Makes the system defensible to partners
ðŸš€ Execute Immediately
Proceed with PHASE K-4 exactly as written.
No deviations. No redesign. No extras.