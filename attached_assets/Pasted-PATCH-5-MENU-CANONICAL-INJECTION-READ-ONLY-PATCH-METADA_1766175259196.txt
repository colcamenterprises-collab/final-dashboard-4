PATCH 5 â€” MENU CANONICAL INJECTION (READ-ONLY)
ğŸ“Œ PATCH METADATA
PROJECT: Final Dashboard 4.0
PATCH NAME: Menu Canonical Injection (Loyverse CSV)
SCOPE: Backend (read-only reference) + Internal comparison
RISK LEVEL: LOW
CHANGE TYPE: Data ingestion (non-destructive)
ğŸš« HARD STOPS (NON-NEGOTIABLE)
Agent MUST NOT:
Replace /api/menu-ordering/full
Change Online Ordering UI behaviour
Change pricing
Touch POS endpoints
Modify Recipes
Modify Daily Sales / Stock
Affect live orders
This patch is read-only + internal only.
ğŸ¯ OBJECTIVE
Load the Loyverse CSV as the canonical menu reference so we can:
Detect menu drift
Validate Online Ordering vs POS vs CSV
Prepare a safe switch later (optional)
Customers see no change.
ğŸ“ FILES / AREAS ALLOWED TO TOUCH
âœ… Backend utility / service layer
âœ… Temporary reference storage (DB table or in-memory cache)
âœ… Internal admin endpoint or service function
âŒ Frontend Online Ordering
âŒ POS APIs
âŒ Pricing logic
ğŸ§© EXECUTION STEPS
STEP 1 â€” INGEST CSV (READ-ONLY)
Load the provided Loyverse CSV:
Item Name
SKU
Category
Normalise fields:
Trim whitespace
Standardise category casing
Store as:
menu_canonical_loyverse (table or in-memory structure)
âš ï¸ This dataset is not used by live ordering.
STEP 2 â€” NORMALISE CURRENT MENUS
Fetch and normalise:
POS menu (existing source)
Online Ordering menu (/api/menu-ordering/full)
Normalisation rules:
Compare by SKU where possible
Fallback to name match (case-insensitive)
STEP 3 â€” GENERATE MENU DRIFT REPORT
Produce an internal comparison result:
Required outputs:
Items in CSV but missing online
Items online but not in CSV
Category mismatches
Duplicate names / SKUs
Items live online but disabled in POS
Store result as:
JSON report
Timestamped
No UI exposure yet unless already available internally.
STEP 4 â€” INTERNAL ACCESS ONLY
Expose results via:
Internal admin endpoint or
Console/log output clearly labelled:
Copy code

MENU DRIFT REPORT â€” LOYVERSE vs ONLINE
No customer-facing surface.
ğŸ§ª VERIFICATION (MANDATORY)
Agent must confirm:
CSV loaded successfully
No impact to live ordering
Drift report generated
No errors in logs
No schema conflicts
ğŸ§¾ AGENT FINAL RESPONSE (STRICT)
Agent must reply only with:
PATCH 5 COMPLETE â€” Canonical menu loaded (read-only)
or
BLOCKED â€” <exact reason>
No commentary.
ğŸ”’ END PATCH 5