ğŸ” REPLIT AGENT â€” EXECUTION INSTRUCTIONS
FOUNDATION-02: Recipe Authority (LOCK-FIRST)
ğŸš¨ READ THIS FIRST (NON-NEGOTIABLE)
This patch establishes Recipe Authority.
This is NOT a UI rebuild.
This is NOT analytics.
This is NOT modifiers or bundles.
This is schema + backend only, with read-only consumption.
Do not refactor or delete existing code.
Do not change staff workflows or forms.
Do not guess. If unclear, STOP and report.
ğŸ¯ OBJECTIVE (SINGLE SENTENCE)
Create a single authoritative Recipe layer that defines how menu items are made and costed, derived strictly from Purchasing Items (ingredients), and safely mapped to POS items.
ğŸ§± CANONICAL DATA CONTRACT (MUST FOLLOW)
Authoritative Sources
purchasing_items â†’ MASTER for everything bought
purchasing_items.is_ingredient = true â†’ ingredients subset
NEW recipe â†’ how food is prepared
NEW recipe_ingredient â†’ ingredient quantities per recipe
NEW pos_item_recipe_map â†’ POS item â†’ recipe mapping
Derived Only (NO WRITES)
Recipe cost
Ingredient usage
Analytics
Emails
UI displays
ğŸ—‚ï¸ PART 1 â€” DATABASE SCHEMA (REQUIRED)
1ï¸âƒ£ Create recipe table
Fields:
id (pk)
name (string, unique)
yield_units (numeric, nullable)
active (boolean, default true)
created_at
2ï¸âƒ£ Create recipe_ingredient table
Fields:
id (pk)
recipe_id (fk â†’ recipe.id)
purchasing_item_id (fk â†’ purchasing_items.id)
quantity (numeric, required)
unit (string, required)
Constraints:
Unique (recipe_id, purchasing_item_id)
Do NOT duplicate ingredient costs here
3ï¸âƒ£ Create pos_item_recipe_map table
Fields:
id (pk)
pos_item_id (string / external ID)
recipe_id (fk â†’ recipe.id)
Constraints:
One POS item â†’ one recipe
Recipe may map to many POS items
ğŸ§  PART 2 â€” SERVER LOGIC (STRICT)
4ï¸âƒ£ Recipe Cost Calculation (READ-ONLY)
Implement server-side function:
Copy code

recipe_cost =
  SUM(
    recipe_ingredient.quantity
    Ã— purchasing_items.unit_cost
  )
Rules:
No caching
No rounding tricks
No UI calculations
Always computed fresh
ğŸ”— PART 3 â€” SAFE CONSUMERS (READ-ONLY ONLY)
Update only these consumers to READ from recipes:
F&B Analysis â†’ show recipe cost if mapping exists
Purchasing Analytics â†’ ingredient usage via recipes
Online Ordering â†’ display recipe-based cost (read-only)
Daily Review Email â†’ include recipe cost where available
âŒ Do NOT modify:
Forms
Purchasing UI
Shopping List logic
Shift Log logic
ğŸ›‘ EXPLICITLY OUT OF SCOPE (DO NOT TOUCH)
Modifiers
Bundles / meal deals
AI logic
UI editing flows
Staff-facing inputs
Purchasing sync logic
Existing ingredient_v2 cleanup
ğŸ§ª VERIFICATION REQUIREMENTS (MANDATORY)
Before marking complete, verify:
purchasing_items remains unchanged
Ingredients derive only from is_ingredient = true
Recipes cannot exist without ingredients
Recipe cost updates automatically when purchasing cost changes
Deleting a purchasing item used in a recipe is blocked
No existing pages break
No data migration alters existing rows
ğŸ“¦ DELIVERABLES
Schema changes committed
Backend services added
Read-only integrations wired
Short verification summary
NO UI screenshots required
ğŸ›‘ STOP CONDITION
If any of the following occurs, STOP and report:
Ambiguity about data ownership
Need to refactor existing flows
Missing purchasing data
Conflicting schema definitions
âœ… SUCCESS CRITERIA (FINAL)
After this patch, the system can truthfully answer:
â€œWhat do we sell, how is it made, and what does it cost?â€
Nothing more. Nothing less.