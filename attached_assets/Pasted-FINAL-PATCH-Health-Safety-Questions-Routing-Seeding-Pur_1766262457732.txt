FINAL PATCH ‚Äî Health & Safety Questions (Routing + Seeding)
Purpose:
Fix 404 on Question Manager and only 1 question showing
Root cause: Route registry mismatch + missing seed data
This patch fixes both.
‚ö†Ô∏è ABSOLUTE AGENT RULES (READ FIRST)
DO
Follow steps in order
Modify only the files specified
Copy-paste exactly
DO NOT
Touch App.tsx routing
Invent new routers
Assume flat routing
Change audit logic
Say ‚Äúcomplete‚Äù until verified
üß© PART A ‚Äî FIX THE 404 (ROUTING ‚Äî NON-NEGOTIABLE)
1Ô∏è‚É£ Locate the Operations Route Registry
One of these WILL exist ‚Äî find the real one used by the app:
Copy code

client/src/router/RouteRegistry.ts
client/src/router/operations.ts
client/src/router/operationsRoutes.ts
client/src/router/routes/operations.ts
You will already see this entry (or equivalent):
Copy code
Ts
{
  path: "/operations/health-safety-audit",
  element: <HealthSafetyAuditPage />
}
2Ô∏è‚É£ ADD THIS ROUTE DIRECTLY UNDER IT
Copy code
Ts
{
  path: "/operations/health-safety-audit/questions",
  element: <HealthSafetyQuestionManager />,
  hidden: true
}
‚úÖ This must be in the same registry
‚ùå Do NOT add this to App.tsx
3Ô∏è‚É£ Verify Imports at Top of File
Copy code
Ts
import HealthSafetyAuditPage from "@/pages/operations/health-safety-audit";
import HealthSafetyQuestionManager from "@/pages/operations/health-safety-audit/questions";
üß© PART B ‚Äî FIX ‚ÄúONLY 1 QUESTION‚Äù (DATA SEED)
4Ô∏è‚É£ Create Seed Script (ONE-TIME USE)
üìÑ Create file:
Copy code

server/scripts/seedHealthSafetyQuestions.ts
üìå PASTE THIS EXACTLY
Copy code
Ts
import { prisma } from "../prisma";

const QUESTIONS = [
  { section: "Raw Meat Storage", label: "Raw meat stored below cooked food", isCritical: true },
  { section: "Raw Meat Storage", label: "Meat fridge ‚â§ 4¬∞C", isCritical: true },
  { section: "Raw Meat Storage", label: "Freezer ‚â§ -18¬∞C", isCritical: true },
  { section: "Raw Meat Handling", label: "Separate raw meat prep area", isCritical: true },
  { section: "Raw Meat Handling", label: "Separate boards and utensils used", isCritical: true },
  { section: "Cooking Safety", label: "Burgers fully cooked (no raw centre)", isCritical: true },
  { section: "Cooking Safety", label: "No bare-hand contact with cooked food", isCritical: true },

  { section: "Frying & Hot Food", label: "Fryer oil clean and changed on schedule", isCritical: false },
  { section: "Frying & Hot Food", label: "Food not mixed between old and new batches", isCritical: false },

  { section: "Cleaning & Sanitation", label: "Prep surfaces cleaned and sanitised", isCritical: false },
  { section: "Cleaning & Sanitation", label: "Floors clean and dry", isCritical: false },
  { section: "Cleaning & Sanitation", label: "Bins emptied and lined", isCritical: false },

  { section: "Staff Hygiene", label: "Clean uniforms worn", isCritical: false },
  { section: "Staff Hygiene", label: "Hands washed correctly", isCritical: false },

  { section: "Environment & Pest Control", label: "No signs of pests", isCritical: false },

  { section: "Equipment & Safety", label: "Fire extinguisher accessible", isCritical: true },
  { section: "Equipment & Safety", label: "Fire blanket accessible", isCritical: true }
];

async function run() {
  await prisma.healthSafetyQuestion.deleteMany();

  for (let i = 0; i < QUESTIONS.length; i++) {
    await prisma.healthSafetyQuestion.create({
      data: {
        ...QUESTIONS[i],
        isActive: true,
        sortOrder: i + 1
      }
    });
  }

  console.log("‚úÖ Health & Safety questions seeded:", QUESTIONS.length);
  process.exit(0);
}

run().catch(err => {
  console.error(err);
  process.exit(1);
});
5Ô∏è‚É£ Run Seed ONCE
Copy code
Bash
npx ts-node server/scripts/seedHealthSafetyQuestions.ts
‚ö†Ô∏è Run once only
‚ö†Ô∏è This replaces existing questions intentionally
üß© PART C ‚Äî VERIFY (MANDATORY)
Agent must confirm ALL below before saying ‚Äúdone‚Äù:
Visit
Copy code

/api/health-safety/questions
‚Üí returns 15+ questions
Visit
Copy code

/operations/health-safety-audit
‚Üí full checklist visible
Click Manage Questions
Copy code

/operations/health-safety-audit/questions
‚Üí ‚ùå NO 404
Toggle a question inactive ‚Üí disappears from audit
üö´ WHAT THE AGENT MUST NOT DO
‚ùå Do not touch App.tsx
‚ùå Do not add fallback routes
‚ùå Do not say ‚ÄúReplit issue‚Äù
‚ùå Do not change permissions
‚ùå Do not add UI logic
‚úÖ SUCCESS STATE (THIS IS THE DEFINITION)
When complete:
Sidebar works
Audit page shows many questions
Question Manager loads
Questions editable
No 404s
No ‚Äúonly 1 question‚Äù
Final instruction to the agent (you can paste this verbatim):
Apply the patch exactly as written.
Do not deviate.
Do not declare success until all verification steps pass.