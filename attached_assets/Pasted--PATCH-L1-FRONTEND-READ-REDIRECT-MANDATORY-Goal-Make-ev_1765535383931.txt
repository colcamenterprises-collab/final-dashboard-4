ğŸŸ¦ PATCH L1 â€” FRONTEND READ REDIRECT (MANDATORY)

ğŸ¯ Goal

Make every existing UI screen automatically read from:

V2/V3 data if present

Legacy data if not


WITHOUT:

changing URLs

breaking routes

duplicating components



---

ğŸ§  STRATEGY (IMPORTANT)

We do not rewrite every page manually.

We patch the API layer abstraction once.


---

ğŸ› ï¸ IMPLEMENTATION (FOR AGENT)

1ï¸âƒ£ Patch the frontend API client (ONE FILE)

Locate (or create):

client/src/lib/api.ts

Add a helper:

async function fetchWithLegacyFallback(primaryUrl: string, legacyUrl: string) {
  const res = await fetch(primaryUrl);
  const data = await res.json();

  if (Array.isArray(data) && data.length > 0) return data;
  if (data?.rows?.length > 0) return data;

  const legacyRes = await fetch(legacyUrl);
  return legacyRes.json();
}


---

2ï¸âƒ£ Apply to ALL READS (NO EXCEPTIONS)

Examples:

Daily Sales

fetchWithLegacyFallback(
  '/api/daily-sales',
  '/api/legacy-bridge/daily-sales'
)

Expenses

fetchWithLegacyFallback(
  '/api/expenses',
  '/api/legacy-bridge/expenses'
)

Shopping List

fetchWithLegacyFallback(
  '/api/shopping-list',
  '/api/legacy-bridge/shopping-list'
)

Ingredients

fetchWithLegacyFallback(
  '/api/ingredients',
  '/api/legacy-bridge/ingredients'
)

Menu

fetchWithLegacyFallback(
  '/api/menu-v3/items',
  '/api/legacy-bridge/menu-items'
)

ğŸš« Do NOT rename components
ğŸš« Do NOT touch UI layout
ğŸš« Do NOT add new routes


---

3ï¸âƒ£ Enable the Legacy Banner (Already Done)

You already added:

<LegacyDataAlert source={data.source} />

Once L1 is wired:

Legacy data will visibly appear

Banner will auto-trigger



---

âœ… SUCCESS CRITERIA (THIS IS WHAT YOUâ€™LL SEE)

After PATCH L1 deploy:

âœ… Daily Sales Library fully populated

âœ… Shopping List shows historical items

âœ… Purchases visible

âœ… Ingredients list fills

âœ… Recipes visible

âœ… Menu items appear

âœ… Expense history restored

âœ… Zero duplication

âœ… Zero write risk


At that point, the system is stable again.


---

ğŸ”’ WHAT WE DO NOT DO YET

âŒ No migrations
âŒ No data copying
âŒ No deletions
âŒ No â€œsync legacy â†’ v2â€ buttons

That is PATCH L2 and only after confirmation.


---
